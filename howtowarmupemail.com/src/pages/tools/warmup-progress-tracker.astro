---
import Base from '../../layouts/Base.astro';
import { siteConfig } from '../../config';

const schema = {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "Email Warm-Up Progress Tracker",
  "applicationCategory": "BusinessApplication",
  "description": "Track your daily warm-up metrics and get real-time health assessments based on deliverability benchmarks.",
  "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
};
---

<Base
  title="Warm-Up Progress Tracker | How to Warm Up Email"
  description="Free tool: enter your current warm-up metrics and get a real-time health assessment with actionable recommendations."
  schema={schema}
>
  <section class="max-w-3xl mx-auto px-4 sm:px-6 py-12 md:py-20">
    <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900">Warm-Up Progress Tracker</h1>
    <p class="mt-4 text-lg text-gray-600">
      Enter your current warm-up metrics. We'll assess your domain's health and recommend next steps.
    </p>

    <div class="mt-10 p-6 border border-gray-200 rounded-lg bg-white">
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
        <div>
          <label for="day-number" class="block text-sm font-medium text-gray-700">Current warm-up day</label>
          <input type="number" id="day-number" value="7" min="1" max="60" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
        </div>
        <div>
          <label for="daily-volume" class="block text-sm font-medium text-gray-700">Emails sent today</label>
          <input type="number" id="daily-volume" value="20" min="0" max="500" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
        </div>
        <div>
          <label for="inbox-rate" class="block text-sm font-medium text-gray-700">Inbox placement rate (%)</label>
          <input type="number" id="inbox-rate" value="82" min="0" max="100" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
        </div>
        <div>
          <label for="bounce-rate" class="block text-sm font-medium text-gray-700">Bounce rate (%)</label>
          <input type="number" id="bounce-rate" value="1.2" min="0" max="100" step="0.1" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
        </div>
        <div>
          <label for="reply-rate" class="block text-sm font-medium text-gray-700">Reply rate (%)</label>
          <input type="number" id="reply-rate" value="35" min="0" max="100" step="0.1" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
        </div>
        <div>
          <label for="spam-rate" class="block text-sm font-medium text-gray-700">Spam complaint rate (%)</label>
          <input type="number" id="spam-rate" value="0" min="0" max="100" step="0.01" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
        </div>
      </div>

      <button id="assess-btn" class="mt-6 px-6 py-3 bg-gray-900 text-white font-semibold rounded-lg hover:bg-gray-800 transition-colors w-full sm:w-auto">
        Assess Warm-Up Health
      </button>

      <div id="results" class="mt-8 hidden">
        <div id="overall-health" class="p-4 rounded-lg mb-4"></div>
        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 mb-6" id="metric-cards"></div>
        <div id="recommendations" class="p-4 bg-gray-50 rounded-lg"></div>
      </div>
    </div>

    <div class="mt-8 p-6 border border-blue-200 rounded-lg bg-blue-50">
      <p class="text-sm font-medium text-blue-900">Want automatic warm-up monitoring?</p>
      <p class="mt-1 text-sm text-blue-700">
        <a href={siteConfig.product.url} target="_blank" rel="noopener noreferrer" class="font-semibold underline">{siteConfig.product.name}</a> monitors warm-up metrics in real-time and auto-adjusts volume to keep your domains healthy.
      </p>
      <a href={siteConfig.product.url} target="_blank" rel="noopener noreferrer" class="mt-3 inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-semibold rounded-md hover:bg-blue-700 transition-colors">
        Monitor with {siteConfig.product.name} &rarr;
      </a>
    </div>
  </section>
</Base>

<script>
  function assess() {
    const day = parseInt((document.getElementById('day-number') as HTMLInputElement).value) || 7;
    const volume = parseInt((document.getElementById('daily-volume') as HTMLInputElement).value) || 20;
    const inbox = parseFloat((document.getElementById('inbox-rate') as HTMLInputElement).value) || 0;
    const bounce = parseFloat((document.getElementById('bounce-rate') as HTMLInputElement).value) || 0;
    const reply = parseFloat((document.getElementById('reply-rate') as HTMLInputElement).value) || 0;
    const spam = parseFloat((document.getElementById('spam-rate') as HTMLInputElement).value) || 0;

    // Expected benchmarks by day
    const expectedInbox = day <= 7 ? 75 : day <= 14 ? 84 : day <= 21 ? 90 : 94;
    const maxBounce = day <= 7 ? 1 : day <= 14 ? 1.5 : 2;
    const minReply = day <= 7 ? 40 : day <= 14 ? 30 : day <= 21 ? 20 : 10;
    const maxSpam = day <= 7 ? 0 : day <= 14 ? 0.03 : 0.08;

    const expectedVolume = day <= 3 ? 15 : day <= 6 ? 20 : day <= 9 ? 30 : day <= 12 ? 45 : day <= 15 ? 55 : day <= 18 ? 70 : day <= 21 ? 80 : 100;

    type Status = 'good' | 'warning' | 'critical';
    const metrics: { label: string; value: string; status: Status }[] = [
      { label: 'Inbox Rate', value: `${inbox}%`, status: inbox >= expectedInbox ? 'good' : inbox >= expectedInbox - 10 ? 'warning' : 'critical' },
      { label: 'Bounce Rate', value: `${bounce}%`, status: bounce <= maxBounce ? 'good' : bounce <= maxBounce + 1.5 ? 'warning' : 'critical' },
      { label: 'Reply Rate', value: `${reply}%`, status: reply >= minReply ? 'good' : reply >= minReply / 2 ? 'warning' : 'critical' },
      { label: 'Spam Rate', value: `${spam}%`, status: spam <= maxSpam ? 'good' : spam <= 0.1 ? 'warning' : 'critical' },
    ];

    const recs: string[] = [];
    if (inbox < expectedInbox) recs.push(`Inbox placement (${inbox}%) is below the day ${day} benchmark of ${expectedInbox}%. Increase warm-up volume and check DNS records.`);
    if (bounce > maxBounce) recs.push(`Bounce rate (${bounce}%) exceeds the safe threshold of ${maxBounce}%. Verify all email addresses before sending. ${bounce > 5 ? 'STOP SENDING IMMEDIATELY.' : ''}`);
    if (reply < minReply) recs.push(`Reply rate (${reply}%) is below expected ${minReply}% for day ${day}. Switch to higher-quality warm-up contacts or check warm-up tool engagement.`);
    if (spam > maxSpam) recs.push(`Spam complaint rate (${spam}%) exceeds threshold. ${spam > 0.1 ? 'Reduce volume by 50% immediately.' : 'Monitor closely and review email content.'}`);
    if (volume > expectedVolume * 1.3) recs.push(`Daily volume (${volume}) may be too high for day ${day}. Expected around ${expectedVolume}. Consider reducing to avoid triggering spam filters.`);
    if (volume < expectedVolume * 0.5 && day > 7) recs.push(`Daily volume (${volume}) is below expected ${expectedVolume} for day ${day}. You may want to increase to stay on schedule.`);
    if (recs.length === 0) recs.push('All metrics look healthy! Continue your current warm-up schedule. You\'re on track for full capacity.');

    const critCount = metrics.filter(m => m.status === 'critical').length;
    const warnCount = metrics.filter(m => m.status === 'warning').length;

    document.getElementById('results')!.classList.remove('hidden');

    const overall = document.getElementById('overall-health')!;
    if (critCount > 0) {
      overall.className = 'p-4 rounded-lg bg-red-50 border border-red-200';
      overall.innerHTML = `<p class="font-semibold text-red-800">⚠ Critical Issues Detected — Action Required</p><p class="text-sm text-red-700 mt-1">Day ${day} of warm-up • ${volume} emails/day</p>`;
    } else if (warnCount > 0) {
      overall.className = 'p-4 rounded-lg bg-yellow-50 border border-yellow-200';
      overall.innerHTML = `<p class="font-semibold text-yellow-800">⚡ Warm-Up In Progress — Minor Adjustments Needed</p><p class="text-sm text-yellow-700 mt-1">Day ${day} of warm-up • ${volume} emails/day</p>`;
    } else {
      overall.className = 'p-4 rounded-lg bg-green-50 border border-green-200';
      overall.innerHTML = `<p class="font-semibold text-green-800">✓ Warm-Up On Track — All Metrics Healthy</p><p class="text-sm text-green-700 mt-1">Day ${day} of warm-up • ${volume} emails/day</p>`;
    }

    const colors = { good: 'border-green-200 text-green-700', warning: 'border-yellow-200 text-yellow-700', critical: 'border-red-200 text-red-700' };
    document.getElementById('metric-cards')!.innerHTML = metrics.map(m =>
      `<div class="p-3 border rounded-lg ${colors[m.status]} text-center">
        <p class="text-xs opacity-75">${m.label}</p>
        <p class="text-xl font-bold mt-1">${m.value}</p>
      </div>`
    ).join('');

    document.getElementById('recommendations')!.innerHTML = `
      <h3 class="text-sm font-semibold text-gray-700">Recommendations</h3>
      <ul class="mt-2 space-y-2 text-sm text-gray-600">${recs.map(r => `<li>• ${r}</li>`).join('')}</ul>`;
  }

  document.getElementById('assess-btn')?.addEventListener('click', assess);
</script>
