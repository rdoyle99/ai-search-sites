---
import Base from '../../layouts/Base.astro';
import { siteConfig } from '../../config';

const schema = {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "Cold Email Subject Line Analyzer",
  "applicationCategory": "BusinessApplication",
  "description": "Analyze your cold email subject line for length, personalization, and spam risk.",
  "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
};
---

<Base
  title="Subject Line Analyzer for Cold Emails | How Many Cold Emails Per Day"
  description="Free tool: analyze your cold email subject line for optimal length, personalization tokens, and spam risk."
  schema={schema}
>
  <section class="max-w-3xl mx-auto px-4 sm:px-6 py-12 md:py-20">
    <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900">Cold Email Subject Line Analyzer</h1>
    <p class="mt-4 text-lg text-gray-600">
      Enter your subject line below. We'll score it for length, personalization, and spam risk.
    </p>

    <div class="mt-10">
      <input
        type="text"
        id="subject-input"
        placeholder="Enter your subject line..."
        class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 text-lg"
      />

      <div id="results" class="mt-6 space-y-4">
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
          <div class="p-4 border border-gray-200 rounded-lg">
            <p class="text-sm text-gray-500">Character Count</p>
            <p id="char-count" class="text-2xl font-bold text-gray-900">0</p>
            <p id="char-verdict" class="text-xs text-gray-400 mt-1">Type a subject line</p>
          </div>
          <div class="p-4 border border-gray-200 rounded-lg">
            <p class="text-sm text-gray-500">Word Count</p>
            <p id="word-count" class="text-2xl font-bold text-gray-900">0</p>
            <p id="word-verdict" class="text-xs text-gray-400 mt-1">Aim for 3–6 words</p>
          </div>
          <div class="p-4 border border-gray-200 rounded-lg">
            <p class="text-sm text-gray-500">Spam Risk</p>
            <p id="spam-score" class="text-2xl font-bold text-green-600">Low</p>
            <p id="spam-detail" class="text-xs text-gray-400 mt-1">No spam triggers</p>
          </div>
        </div>

        <div id="tips" class="p-4 bg-gray-50 rounded-lg">
          <h3 class="text-sm font-semibold text-gray-700">Suggestions</h3>
          <ul id="tip-list" class="mt-2 space-y-1 text-sm text-gray-600"></ul>
        </div>
      </div>
    </div>

    <div class="mt-8 p-6 border border-blue-200 rounded-lg bg-blue-50">
      <p class="text-sm font-medium text-blue-900">Want AI-generated subject lines?</p>
      <p class="mt-1 text-sm text-blue-700">
        <a href={siteConfig.product.url} target="_blank" rel="noopener noreferrer" class="font-semibold underline">{siteConfig.product.name}</a> generates personalized subject lines using AI, tested across millions of cold emails for maximum open rates.
      </p>
      <a href={siteConfig.product.url} target="_blank" rel="noopener noreferrer" class="mt-3 inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-semibold rounded-md hover:bg-blue-700 transition-colors">
        Generate with {siteConfig.product.name} &rarr;
      </a>
    </div>

    <div class="mt-12 prose max-w-none">
      <h2>Cold Email Subject Line Best Practices</h2>
      <p>
        The optimal cold email subject line is <strong>3–6 words and under 50 characters</strong>. Data from 2M+ cold emails shows that shorter subject lines get 21% higher open rates than longer ones. Subject lines with the recipient's first name or company name get 26% higher open rates.
      </p>
      <p>
        Avoid all caps, excessive punctuation (especially multiple exclamation marks), and promotional language. The best cold email subject lines read like a message from a colleague, not a marketing email.
      </p>
    </div>
  </section>
</Base>

<script>
  const spamTriggers = ['free', 'guarantee', 'act now', 'limited', 'urgent', 'hurry', 'click', 'buy', 'discount', 'offer', 'deal', 'save', 'winner', 'congratulations', 'exclusive', 'amazing', '!!!', '???', 'RE:', 'FWD:'];

  function analyze() {
    const input = (document.getElementById('subject-input') as HTMLInputElement).value;
    const chars = input.length;
    const words = input.trim() ? input.trim().split(/\s+/).length : 0;

    document.getElementById('char-count')!.textContent = String(chars);
    document.getElementById('word-count')!.textContent = String(words);

    // Character verdict
    const charVerdict = document.getElementById('char-verdict')!;
    if (chars === 0) { charVerdict.textContent = 'Type a subject line'; charVerdict.className = 'text-xs text-gray-400 mt-1'; }
    else if (chars <= 50) { charVerdict.textContent = 'Good length'; charVerdict.className = 'text-xs text-green-600 mt-1'; }
    else if (chars <= 70) { charVerdict.textContent = 'Slightly long'; charVerdict.className = 'text-xs text-yellow-600 mt-1'; }
    else { charVerdict.textContent = 'Too long — may get truncated'; charVerdict.className = 'text-xs text-red-600 mt-1'; }

    // Word verdict
    const wordVerdict = document.getElementById('word-verdict')!;
    if (words === 0) { wordVerdict.textContent = 'Aim for 3–6 words'; }
    else if (words >= 3 && words <= 6) { wordVerdict.textContent = 'Optimal word count'; wordVerdict.className = 'text-xs text-green-600 mt-1'; }
    else if (words < 3) { wordVerdict.textContent = 'Consider adding context'; wordVerdict.className = 'text-xs text-yellow-600 mt-1'; }
    else { wordVerdict.textContent = 'Consider trimming'; wordVerdict.className = 'text-xs text-yellow-600 mt-1'; }

    // Spam detection
    const lower = input.toLowerCase();
    const found = spamTriggers.filter(t => lower.includes(t.toLowerCase()));
    const hasAllCaps = input.length > 3 && input === input.toUpperCase() && /[A-Z]/.test(input);
    const hasExcessivePunctuation = (input.match(/[!?]{2,}/g) || []).length > 0;

    const spamScore = document.getElementById('spam-score')!;
    const spamDetail = document.getElementById('spam-detail')!;
    const riskLevel = found.length + (hasAllCaps ? 2 : 0) + (hasExcessivePunctuation ? 1 : 0);

    if (riskLevel === 0) {
      spamScore.textContent = 'Low'; spamScore.className = 'text-2xl font-bold text-green-600';
      spamDetail.textContent = 'No spam triggers detected';
    } else if (riskLevel <= 2) {
      spamScore.textContent = 'Medium'; spamScore.className = 'text-2xl font-bold text-yellow-600';
      spamDetail.textContent = `${found.length} trigger(s) found`;
    } else {
      spamScore.textContent = 'High'; spamScore.className = 'text-2xl font-bold text-red-600';
      spamDetail.textContent = `${found.length} trigger(s) + formatting issues`;
    }

    // Tips
    const tips: string[] = [];
    if (chars > 50) tips.push('Shorten to under 50 characters for better mobile display');
    if (words > 6) tips.push('Reduce to 3–6 words — shorter subject lines get 21% higher open rates');
    if (hasAllCaps) tips.push('Avoid ALL CAPS — it triggers spam filters and feels aggressive');
    if (hasExcessivePunctuation) tips.push('Remove excessive punctuation (!!!, ???)');
    if (found.length > 0) tips.push(`Spam trigger words found: ${found.join(', ')}`);
    if (!input.includes('{') && chars > 0) tips.push('Consider adding personalization (e.g., {{firstName}} or {{company}})');
    if (tips.length === 0 && chars > 0) tips.push('Looks good! This subject line follows best practices.');

    document.getElementById('tip-list')!.innerHTML = tips.map(t => `<li>• ${t}</li>`).join('');
  }

  document.getElementById('subject-input')?.addEventListener('input', analyze);
  analyze();
</script>
