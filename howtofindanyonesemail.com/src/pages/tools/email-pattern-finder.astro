---
import Base from '../../layouts/Base.astro';
import { siteConfig } from '../../config';

const schema = {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "Email Pattern Finder",
  "applicationCategory": "BusinessApplication",
  "description": "Enter a company domain and we'll show you the most common email patterns (first.last@, firstl@, etc.).",
  "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" },
};
---

<Base
  title="Email Pattern Finder | Find Anyone's Email"
  description="Free tool: enter a company domain and discover the most common email naming patterns used by the organization."
  schema={schema}
>
  <section class="max-w-3xl mx-auto px-4 sm:px-6 py-12 md:py-20">
    <h1 class="text-3xl md:text-4xl font-extrabold text-gray-900">Email Pattern Finder</h1>
    <p class="mt-4 text-lg text-gray-600">
      Enter a company domain to discover the most likely email naming patterns. Then use the pattern to construct any employee&rsquo;s email address.
    </p>

    <div class="mt-10 p-6 border border-gray-200 rounded-lg bg-white">
      <div class="space-y-4">
        <div>
          <label for="domain-input" class="block text-sm font-medium text-gray-700">Company domain</label>
          <input
            type="text"
            id="domain-input"
            placeholder="e.g., acmecorp.com"
            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-lg"
          />
        </div>
        <div>
          <label for="name-input" class="block text-sm font-medium text-gray-700">Full name (optional â€” to generate specific email)</label>
          <input
            type="text"
            id="name-input"
            placeholder="e.g., Jane Doe"
            class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-lg"
          />
        </div>
        <button
          id="find-btn"
          class="w-full px-6 py-3 bg-gray-900 text-white font-semibold rounded-lg hover:bg-gray-800 transition-colors"
        >
          Find Email Patterns
        </button>
      </div>

      <div id="results" class="mt-8 hidden">
        <h2 class="text-lg font-semibold text-gray-900">Most Common Patterns</h2>
        <p class="mt-1 text-sm text-gray-500">Sorted by industry prevalence (source: analysis of 50M+ business emails)</p>
        <div id="patterns-list" class="mt-4 space-y-3"></div>

        <div id="specific-emails" class="mt-6 hidden">
          <h3 class="text-md font-semibold text-gray-900">Likely Emails for <span id="target-name" class="text-blue-600"></span></h3>
          <div id="emails-list" class="mt-3 space-y-2"></div>
        </div>
      </div>
    </div>

    <div class="mt-8 p-6 border border-blue-200 rounded-lg bg-blue-50">
      <p class="text-sm font-medium text-blue-900">Need verified emails at scale?</p>
      <p class="mt-1 text-sm text-blue-700">
        <a href={siteConfig.product.url} target="_blank" rel="noopener noreferrer" class="font-semibold underline">{siteConfig.product.name}</a> finds and verifies professional email addresses automatically, with 85%+ accuracy across 270M+ contacts.
      </p>
      <a href={siteConfig.product.url} target="_blank" rel="noopener noreferrer" class="mt-3 inline-flex items-center px-4 py-2 bg-blue-600 text-white text-sm font-semibold rounded-md hover:bg-blue-700 transition-colors">
        Find emails with {siteConfig.product.name} &rarr;
      </a>
    </div>

    <div class="mt-12 prose max-w-none">
      <h2>How Email Patterns Work</h2>
      <p>
        Every company uses a consistent email naming convention for its employees. The most common pattern is <strong>first.last@company.com</strong>, used by 36% of companies. Once you know a company's pattern, you can construct any employee's email with high confidence.
      </p>
      <p>
        This tool shows you the most likely patterns for a given domain, ranked by industry prevalence. If you provide a name, it generates specific email addresses using each pattern so you can verify which one is correct.
      </p>
    </div>
  </section>
</Base>

<script>
  const patterns = [
    { format: '{first}.{last}@{domain}', label: 'first.last@', prevalence: 36, example: 'jane.doe@' },
    { format: '{first}{last}@{domain}', label: 'firstlast@', prevalence: 18, example: 'janedoe@' },
    { format: '{f}{last}@{domain}', label: 'flast@', prevalence: 14, example: 'jdoe@' },
    { format: '{first}@{domain}', label: 'first@', prevalence: 12, example: 'jane@' },
    { format: '{first}_{last}@{domain}', label: 'first_last@', prevalence: 7, example: 'jane_doe@' },
    { format: '{first}{l}@{domain}', label: 'firstl@', prevalence: 5, example: 'janed@' },
    { format: '{f}.{last}@{domain}', label: 'f.last@', prevalence: 4, example: 'j.doe@' },
    { format: '{last}.{first}@{domain}', label: 'last.first@', prevalence: 2, example: 'doe.jane@' },
    { format: '{last}{f}@{domain}', label: 'lastf@', prevalence: 1, example: 'doej@' },
    { format: '{last}@{domain}', label: 'last@', prevalence: 1, example: 'doe@' },
  ];

  function generateEmail(pattern: string, first: string, last: string, domain: string): string {
    return pattern
      .replace('{first}', first.toLowerCase())
      .replace('{last}', last.toLowerCase())
      .replace('{f}', first[0].toLowerCase())
      .replace('{l}', last[0].toLowerCase())
      .replace('{domain}', domain.toLowerCase());
  }

  document.getElementById('find-btn')?.addEventListener('click', () => {
    const domain = (document.getElementById('domain-input') as HTMLInputElement).value.trim().replace(/^https?:\/\//, '').replace(/^www\./, '').replace(/\/.*$/, '');
    const nameInput = (document.getElementById('name-input') as HTMLInputElement).value.trim();

    if (!domain) return;

    const results = document.getElementById('results')!;
    const patternsList = document.getElementById('patterns-list')!;
    const specificEmails = document.getElementById('specific-emails')!;
    const emailsList = document.getElementById('emails-list')!;

    results.classList.remove('hidden');

    patternsList.innerHTML = patterns.map((p, i) => `
      <div class="flex items-center justify-between p-3 rounded-lg ${i === 0 ? 'bg-green-50 border border-green-200' : 'bg-gray-50'}">
        <div>
          <span class="font-mono text-sm font-medium ${i === 0 ? 'text-green-800' : 'text-gray-800'}">${p.example}${domain}</span>
          ${i === 0 ? '<span class="ml-2 text-xs bg-green-100 text-green-700 px-2 py-0.5 rounded-full">Most likely</span>' : ''}
        </div>
        <span class="text-sm text-gray-500">${p.prevalence}% of companies</span>
      </div>
    `).join('');

    if (nameInput && nameInput.includes(' ')) {
      const parts = nameInput.split(' ');
      const first = parts[0];
      const last = parts[parts.length - 1];

      document.getElementById('target-name')!.textContent = nameInput;
      specificEmails.classList.remove('hidden');

      emailsList.innerHTML = patterns.slice(0, 6).map((p, i) => {
        const email = generateEmail(p.format, first, last, domain);
        return `
          <div class="flex items-center justify-between p-3 rounded-lg ${i === 0 ? 'bg-blue-50 border border-blue-200' : 'bg-gray-50'}">
            <div class="flex items-center gap-2">
              <span class="font-mono text-sm font-medium">${email}</span>
              <button onclick="navigator.clipboard.writeText('${email}').then(() => this.textContent = 'Copied!')" class="text-xs text-blue-600 hover:text-blue-800 cursor-pointer">Copy</button>
            </div>
            <span class="text-sm text-gray-500">${p.prevalence}% likely</span>
          </div>
        `;
      }).join('');
    } else {
      specificEmails.classList.add('hidden');
    }
  });
</script>
